\newpage
# 05. Trend {#intro}

```{r 5.0.1-global, echo=FALSE, include=FALSE, message = FALSE, warning=FALSE}
library(data.table)
library(dplyr)
library(flextable)
library(kableExtra)
library(officer)
```

```{r 5.0.2-setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r 5.0.3-tinytex, include=FALSE}
options(tinytex.verbose = TRUE)
```

```{r 5.0.4-rdsInput, echo=FALSE}
# ------------------------------------------------------------------------------
ay                   <- readRDS(here::here("rds", "ay.rds"))
ay_0_row             <- as.integer(readRDS(here::here("rds", "currentAY_row.rds")))
# ------------------------------------------------------------------------------
dt05_aid_awd         <- setDT(readRDS(here::here("rds", "dt05_aid_awd.rds")))
# ------------------------------------------------------------------------------
```

```{r 5.0.5-duke-logo, echo=FALSE, out.width = '100%'}
knitr::include_graphics(here::here('images/GEORGIA-XH-FC.png'))
```

<h2><center><b>Academic Year Student Financial Aid Awards by Type:</b></center></h2>
<h3><center><b>For Academic Years 2018-19 and 2019-20</b></center></h3>
<br>
<!-- ## For Academic Years 2018-19 and 2019-20 -->

## 05. Academic Year Student Financial Aid Awards by Type Table
```{r _5.1, echo=FALSE, fig.cap='Awd by Type', eval = dt05_aid_awd, message=FALSE, warning=FALSE}

ft_awd     <- flextable(dt05_aid_awd)

typology   <- data.frame(
  col_keys = c("program",
               "ug_awd_0",
               "ug_amt_0",
               "gr_awd_0",
               "gr_amt_0",
               "awd_tot_0",
               "amt_tot_0",
               "ug_awd_1",
               "ug_amt_1",
               "gr_awd_1",
               "gr_amt_1",
               "awd_tot_1",
               "amt_tot_1"),
# type     = c("factor", as.character(rep(c("int", "double"),6))),
  what     = c("", as.character(rep(ay[ay_0_row,2], 6)), as.character(rep(ay[ay_0_row - 1,2], 6))),
  measure  = c("Student Aid Program", "# Awards", "Amt Undergrad", "# Awards", "Amt Undergrad", "Total # Awards",
               "Total Amount", "# Awards", "Amt Undergrad", "# Awards", "Amt Undergrad", "Total # Awards", "Total Amount"
               ),
  stringsAsFactors = FALSE )

ft_awd     <- set_header_df(ft_awd, mapping = typology, key = "col_keys" )
ft_awd     <- merge_h(ft_awd, part = "header")
ft_awd     <- merge_v(ft_awd, part = "header")

cur_keys   <- c("ug_amt_0", "gr_amt_0", "amt_tot_0", "ug_amt_1", "gr_amt_1", "amt_tot_1")
int_keys   <- c("ug_awd_0", "gr_awd_0", "awd_tot_0", "ug_awd_1", "gr_awd_1", "awd_tot_1")

ft_awd     <- colformat_int(ft_awd, j = cur_keys, big.mark = ",", prefix = "$")
ft_awd     <- colformat_int(ft_awd, j = int_keys, big.mark = ",", prefix = "")

ft_awd     <- fontsize(ft_awd, size = 8, part = "body")
# ft_awd     <- theme_booktabs(ft_awd) %>%
ft_awd     <- bold(ft_awd, part = "all", bold = TRUE )

border     <- officer::fp_border()
# ft_awd   <- vline(ft_awd, j = 1, border = border, part = "body")
ft_awd     <- vline(ft_awd, j = c(1,7), border = border, part = "all")

ft_awd     <- align_nottext_col(ft_awd, align = "center", header = TRUE, footer = TRUE)

ft_awd     <- fix_border_issues(ft_awd) %>%
              fit_to_width(max_width = 8.50) %>%
              set_caption("")
ft_awd
```
