# ------------------------------------------------------------------------------
# 01. ABC items: What percentage of items sold were pencils? Binders?        ---
# ------------------------------------------------------------------------------
################################################################################
## Step 01.01 clean the tables                                               ###
################################################################################
x01 <- grep("^abc", ls(), value = TRUE)
# ------------------------------------------------------------------------------
lapply(x01, function(nm) {
  df  <- get(nm)
  setDT(df)
  setkey(df, "item")
  setorder(df, item)
  }
)
################################################################################
## Step 01.02 - set the tables                                               ###
################################################################################
dt01_items_sold <-  data.table::cube(abc.data, j=sum(units), by="item")[-.N]
dt01_items_sold =   data.table(
                    mutate(dt01_items_sold,
                    pct_item      = (V1 / sum(V1)) * 100) %>%
                    adorn_totals("row")                              # grand total
                )
names(dt01_items_sold)[2] <- "count"
################################################################################
## Step 01.03 viz the tables                                                 ###
################################################################################
p01a1_bar <-  plot_ly(dt01_items_sold[-.N],
                x         = ~item,
                y         = ~pct_item,
                marker    = list(color = '#012169'),
                name      = 'Item Count',
                type      = 'bar') %>%
        layout( title     = "ABC Company - Percentage of Items Sold",
                xaxis     = list(
                  title   = "Item",
                tickangle = -45),
                yaxis     = list(
                  title   = "Max Award Amount",
                  tickformat = "%"))
################################################################################
## Step 01.99: VERSION HISTORY                                               ###
################################################################################
a00.version = "1.0.0"
a00.ModDate = as.Date("2020-12-28")
# ------------------------------------------------------------------------------
# 2020.12.28 - v.1.0.0
# 1st release
# ------------------------------------------------------------------------------
